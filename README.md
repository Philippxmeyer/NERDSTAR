![NERDSTAR Banner](docs/nerdstar-banner.png)


> *Because even the cosmos deserves a little nerd power.*

---

## üöÄ Was ist NERDSTAR?

NERDSTAR ist der Versuch, einen ESP32 dazu zu √ºberreden,
dein Teleskop mit der Pr√§zision eines NASA-Gyros und dem Charme eines Bastelkellers zu bewegen.

Zwei **TMC2209**-Treiber, ein **Joystick**, ein **OLED**, eine **RTC**
und ein Hauch Gr√∂√üenwahn ergeben zusammen ein
**RA/DEC-Steuerungssystem mit ¬µs-Timing und Stil**.

> Kein KI-Overkill.
> Nur ehrlicher Schrittmotor-Schwei√ü und ein bisschen Mathematik.

---

## üß¨ Features

| Kategorie                     | Beschreibung                                                                 |
| ----------------------------- | ---------------------------------------------------------------------------- |
| üî≠ **Dual Axis Control**      | Zwei Achsen (RA & DEC) mit unabh√§ngigen ¬µs-Hardware-Timern                  |
| üîπ **Joystick Navigation**    | Joystick f√ºr manuelles Slewen, Encoder f√ºr Men√ºs                            |
| üß≠ **Goto & Catalog**         | Objektbibliothek direkt aus dem EEPROM, Auswahl per Encoder, automatisches Goto |
| üíæ **EEPROM-Katalog**         | 200 vorkonfigurierte Sterne/Nebel/Galaxien/Planeten, beim Start automatisch geladen |
| üïí **RTC DS3231**             | Uhrzeit via Setup-Men√º setzen, Grundlage f√ºr Planetenpositionen             |
| ü™ê **Planetenberechnung**     | Schlanker Algorithmus liefert aktuelle RA/Dec f√ºr klassische Planeten       |
| üîß **Setup & Kalibrierung**   | Men√º f√ºr RTC-Zeit, Joystick-Zentrum, Achsenkalibrierung & EEPROM-Speicher   |
| üì∫ **OLED Status Display**    | Zeigt RA/Dec, Tracking-/Goto-Status und gew√§hltes Ziel                      |
| ‚öôÔ∏è **¬µs-Timersteuerung**      | Stepper laufen so gleichm√§√üig, dass man sie fast atmen h√∂rt                |
| üß† **ESP32 Dual-Core**        | Hauptrechner: Core 1 steuert die Motoren, Core 0 berechnet Kurs & Protokoll |
| üîå **Zwei ESP32**             | Zweiter ESP32-C3 k√ºmmert sich ausschlie√ülich um HID (Display, Joystick, Persistenz) |

---

## üíÆ Projektziel (philosophisch betrachtet)

> ‚ÄûWenn‚Äôs sich dreht und der Himmel nicht wegl√§uft, war‚Äôs ein Erfolg.‚Äú
> ‚Äî *Philipp, 2025*

NERDSTAR ist modular aufgebaut:
Erst manuell bewegen, dann automatisch nachf√ºhren,
und irgendwann sagen: ‚ÄûLauf, kleiner ESP, lauf mit den Sternen.‚Äú

---

## ‚öôÔ∏è Hardware√ºbersicht

| Komponente             | Aufgabe                             | Pins / Anschl√ºsse                     |
| ---------------------- | ----------------------------------- | ------------------------------------- |
| **ESP32 (Hauptrechner)** | Kursberechnung + Motorsteuerung      | UART1 TX‚ÄØ(33) ‚Üî HID-RX, UART1 RX‚ÄØ(32) ‚Üî HID-TX |
| **ESP32-C3 (HID)**     | Display, Eingaben, EEPROM-Katalog    | UART1 TX‚ÄØ(21) ‚Üî Main-RX, UART1 RX‚ÄØ(20) ‚Üî Main-TX |
| **TMC2209 (RA)**       | Dreht um die Rektaszensions-Achse   | STEP‚ÄØ25, DIR‚ÄØ26, EN‚ÄØ27, UART TX/RX‚ÄØ=‚ÄØ17/16 |
| **TMC2209 (DEC)**      | Dreht um die Deklinations-Achse     | STEP‚ÄØ13, DIR‚ÄØ12, EN‚ÄØ14, UART TX/RX‚ÄØ=‚ÄØ5/4 |
| **OLED (SSD1306)**     | Zeigt alles an, au√üer Mitleid       | I¬≤C: SDA‚ÄØ8, SCL‚ÄØ9 (HID-ESP32-C3)      |
| **RTC (DS3231)**       | Sagt dir, wann du‚Äôs verpasst hast   | I¬≤C: SDA‚ÄØ8, SCL‚ÄØ9 (HID-ESP32-C3)      |
| **Joystick (KY-023)**  | Steuert alles intuitiv falsch herum | VRx‚ÄØ0, VRy‚ÄØ1, SW‚ÄØ6 (HID-ESP32-C3)     |
| **Rotary-Encoder**     | Men√º & Best√§tigungen                | A‚ÄØ=‚ÄØ3, B‚ÄØ=‚ÄØ4, Button‚ÄØ=‚ÄØ5 (HID-ESP32-C3) |

### üîå Verkabelung im Detail

#### Hauptrechner-ESP32 ‚Üí Motortreiber

| Signal                   | Pin am ESP32 (Main) | Anschluss am TMC2209 (RA) | Anschluss am TMC2209 (DEC) |
| ------------------------ | ------------------- | ------------------------- | -------------------------- |
| Enable                   | 27                  | EN                        | EN                         |
| Richtung (DIR)           | 26                  | DIR                       | ‚Äì                          |
| Schritt (STEP)           | 25                  | STEP                      | ‚Äì                          |
| Richtung (DIR)           | 12                  | ‚Äì                         | DIR                        |
| Schritt (STEP)           | 13                  | ‚Äì                         | STEP                       |
| Treiber-UART TX          | 17                  | PDN/UART                  | ‚Äì                          |
| Treiber-UART RX          | 16                  | PDN/UART                  | ‚Äì                          |
| Treiber-UART TX          | 5                   | ‚Äì                         | PDN/UART                   |
| Treiber-UART RX          | 4                   | ‚Äì                         | PDN/UART                   |
| Versorgung & Masse       | 5‚ÄØV / GND           | VM / GND                  | VM / GND                   |

> Hinweis: Beide TMC2209 teilen sich die Versorgung, die UART-Leitungen sind getrennt. TX und RX bitte jeweils an den PDN/UART-Pin laut Modulbelegung anschlie√üen.

#### HID-ESP32-C3 ‚Üí Benutzerschnittstellen

| Ger√§t / Signal                  | Pin am ESP32 (HID) | Bemerkung |
| -------------------------------- | ------------------ | --------- |
| OLED + RTC SDA                   | 8                  | Gemeinsamer I¬≤C-Bus |
| OLED + RTC SCL                   | 9                  | Gemeinsamer I¬≤C-Bus |
| Rotary-Encoder A                 | 3                  | INPUT_PULLUP verwenden |
| Rotary-Encoder B                 | 4                  | INPUT_PULLUP verwenden |
| Rotary-Encoder Button            | 5                  | Mit INPUT_PULLUP betreiben |
| Joystick X (VRx)                 | 0                  | ADC, high impedance |
| Joystick Y (VRy)                 | 1                  | ADC |
| Joystick Button                  | 6                  | LOW-aktiv |
| Gemeinsame Versorgung f√ºr HID    | 3.3‚ÄØV / GND        | Alle Sensoren/Bedienelemente |

#### Verbindung zwischen den beiden ESP32

- **TX‚ÄØ‚Üî‚ÄØRX kreuzen:** Main-TX (GPIO‚ÄØ33) ‚Üí HID-RX (GPIO‚ÄØ20) und Main-RX (GPIO‚ÄØ32) ‚Üê HID-TX (GPIO‚ÄØ21)
- **GND verbinden:** Gemeinsamer Bezugspunkt f√ºr UART und Sensoren
- Optional: **5‚ÄØV / 3.3‚ÄØV** gemeinsam einspeisen, wenn beide Boards aus derselben Quelle versorgt werden
- USB bleibt frei: Beide Boards k√∂nnen weiterhin √ºber ihren USB-Port debuggt bzw. mit Logausgaben versorgt werden.

Diese Belegung entspricht exakt den Konstanten in [`config.h`](config.h) und stellt sicher, dass jede Komponente am richtigen Controller h√§ngt.

---

## üß† Softwarestruktur

```
NERDSTAR/
‚îÇ
‚îú‚îÄ‚îÄ NERDSTAR.ino           # Orchestriert Setup/Loop
‚îú‚îÄ‚îÄ catalog.cpp/.h         # EEPROM-Katalog & Parser
‚îú‚îÄ‚îÄ display_menu.cpp/.h    # OLED-Men√ºs, Setup, Goto, Polar Align
‚îú‚îÄ‚îÄ input.cpp/.h           # Joystick + Encoder Handling
‚îú‚îÄ‚îÄ motion_main.cpp/.h     # Stepper-Steuerung & Kursberechnung (Hauptrechner)
‚îú‚îÄ‚îÄ motion_hid.cpp         # RPC-Proxy f√ºr Motion-Funktionen (HID)
‚îú‚îÄ‚îÄ comm.cpp/.h            # UART-Protokoll zwischen Hauptrechner und HID
‚îú‚îÄ‚îÄ planets.cpp/.h         # Schlanke Planeten-Ephemeriden
‚îú‚îÄ‚îÄ storage.cpp/.h         # EEPROM-Konfiguration & Katalogspeicher
‚îú‚îÄ‚îÄ config.h               # Pinout & Konstanten
‚îú‚îÄ‚îÄ data/catalog.xml       # Quellliste f√ºr den eingebauten Katalog
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ BEDIENUNGSANLEITUNG.md # Schritt-f√ºr-Schritt-Bedienung
‚îÇ   ‚îî‚îÄ‚îÄ nerdstar-banner.png    # F√ºr die Optik
‚îú‚îÄ‚îÄ LICENSE
‚îî‚îÄ‚îÄ README.md
```

---

### Firmware-Varianten

- **HID-Firmware (Standard)**: Ohne zus√§tzliche Defines kompilieren. Baut das
  UI f√ºr Display, Joystick, Katalog und spricht den Hauptrechner per UART an.
- **Hauptrechner-Firmware**: In den Compiler-Optionen `DEVICE_ROLE_MAIN`
  definieren (z.B. `-DDEVICE_ROLE_MAIN`). Der Code initialisiert die
  Schrittmotoren, startet zwei Tasks (Core‚ÄØ0 = Kursberechnung & Protokoll,
  Core‚ÄØ1 = Motorsteuerung) und beantwortet alle Motion-RPCs.

Beide Varianten verwenden nun **UART1** f√ºr die Verbindung: Beim Hauptrechner
laufen die Leitungen √ºber **TX33/RX32**, die HID-Variante mit dem ESP32-C3
SuperMini nutzt **TX21/RX20**. Damit bleibt der jeweilige USB-Seriell-Port f√ºr
Debugging und Logausgaben frei.

---

## üìñ Dokumentation & Daten

- [Bedienungsanleitung](docs/BEDIENUNGSANLEITUNG.md) mit Schritt-f√ºr-Schritt-Anweisungen
- Beispiel-Datenbank: [`data/catalog.xml`](data/catalog.xml) ‚Äì dient als Quelle f√ºr den eingebauten EEPROM-Katalog
- Alle Kalibrierungen & Zust√§nde werden im EEPROM des ESP32 abgelegt

---

## üì∫ OLED-Anzeige

```
NERDSTAR Status
RA: 05h 34m 31s
Dec: +22¬∞ 00' 52"
Align: Yes  Trk: On
Sel: Messier 042
Goto: --
```

> Wenn du das siehst, wei√üt du wohin das Teleskop blickt.
> Wenn nicht, hilft die [Bedienungsanleitung](docs/BEDIENUNGSANLEITUNG.md).

---

## üõ∞Ô∏è Nachf√ºhrung & Goto

- **Polar Alignment**: eigener Men√ºpunkt, speichert den Align-Status im EEPROM.
- **Tracking**: siderisches Tracking nach erfolgreicher Ausrichtung per Knopfdruck.
- **Goto**: Auswahl im Katalog, Start im Hauptmen√º, Abbruch jederzeit √ºber den Joystick.
- **Planeten**: aktuelle Positionen werden aus der RTC-Zeit berechnet ‚Äì keine statischen Tabellen.

Kurz gesagt: Der ESP32 wei√ü, wohin es geht, und bleibt dank Tracking dort.

---

## üß∞ Abh√§ngigkeiten

| Bibliothek         | Zweck                              | Empfohlene Version |
| ------------------ | ---------------------------------- | ------------------ |
| `TMCStepper`       | Kommunikation mit TMC2209          | ‚â• 0.7.3            |
| `Adafruit_SSD1306` | OLED-Anzeige                       | ‚â• 2.5.9            |
| `Adafruit_GFX`     | Grafik-Backend                     | ‚â• 1.11.9           |
| `RTClib`           | DS3231 RTC                         | ‚â• 2.1.3            |

---

## ‚ö° Installation

1. Arduino IDE √∂ffnen
2. Boards w√§hlen:
   - HID-Controller: **ESP32C3 Dev Module** (ESP32-C3 SuperMini)
   - Hauptrechner: **ESP32 Dev Module**
3. Bibliotheken installieren (siehe oben)
4. **HID-ESP32-C3** flashen (ohne zus√§tzliche Build-Flags)
5. **Hauptrechner-ESP32** flashen (Build-Flag `-DDEVICE_ROLE_MAIN` setzen)
6. UART kreuzen: Main-TX33 ‚Üî HID-RX20, Main-RX32 ‚Üî HID-TX21, GND verbinden
7. Kaffee holen
8. Freuen, dass du was gebaut hast, das klingt wie ein NASA-Projekt und aussieht wie ein Nerd-Traum.

---

## üì∏ Fun Fact

> ‚ÄûWarum NERDSTAR?‚Äú
> ‚Äì Weil *‚ÄòAlt/Az-Mount Controller with Dual-Axis Timer Sync and Real-Time RTC Support‚Äô*
> nicht gut auf ein T-Shirt passt.

---

## üí© Lizenz

GNU General Public License v3.0 ¬© 2025 Philipp

> Benutze, forke, modifiziere ‚Äì aber denk dran:
> Auch im Weltall gilt: Kein Support bei falscher Polausrichtung.

---

## ‚ú® Schlusswort

**NERDSTAR** ‚Äì
Ein Projekt f√ºr Menschen, die beim Wort *Stepper*
nicht an Aerobic, sondern an Himmelsmechanik denken.

ü§ìüå† *Stay nerdy, track steadily.*
